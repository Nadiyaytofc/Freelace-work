<!DOCTYPE html>
<html lang="si">
<head>
  <meta charset="utf-8">
  <title>Registration Form - Freelance Work</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <style>
    body { background-color: #0b1220; color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 15px; position: relative; padding-bottom: 80px; }
    .container { max-width: 750px; margin: 0 auto; }
    
    .home-btn { position: absolute; top: 15px; right: 15px; background: #38bdf8; color: #000; padding: 8px 18px; border-radius: 20px; text-decoration: none; font-weight: bold; font-size: 0.9rem; transition: 0.3s; z-index: 100; }
    .home-btn:hover { background: #fff; }

    .notice-card { background: rgba(15, 23, 42, 0.8); border: 1px solid #1e293b; border-radius: 15px; padding: 20px; margin-bottom: 25px; border-left: 5px solid #38bdf8; margin-top: 60px; }
    .notice-card h3 { color: #38bdf8; margin-top: 0; font-size: 1.1rem; }
    .notice-list { font-size: 0.85rem; color: #cbd5e1; padding-left: 20px; }
    .notice-list li { margin-bottom: 5px; }

    .form-wrapper { background: #fff; color: #334155; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    .tabs { display: flex; background: #000; padding: 5px; border-radius: 12px; margin-bottom: 20px; }
    .tab { flex: 1; text-align: center; color: white; padding: 8px; font-size: 0.7rem; border-radius: 8px; }
    .active-tab { background: #38bdf8; color: black; font-weight: bold; }
    
    label { display: block; margin-top: 15px; font-weight: bold; font-size: 0.85rem; color: #000; }
    input, select { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #cbd5e1; border-radius: 8px; box-sizing: border-box; font-size: 0.9rem; color: #000; }
    .btn-register { background: #1d4ed8; color: white; width: 100%; padding: 16px; border: none; border-radius: 30px; font-weight: bold; font-size: 1rem; margin-top: 25px; cursor: pointer; transition: 0.3s; }
    .btn-register:hover { background: #2563eb; }
    
    .error-section { margin-top: 30px; background: #0f172a; border-radius: 15px; padding: 15px; border: 1px solid #334155; margin-bottom: 20px; }
    .error-section h4 { color: #ef4444; margin-top: 0; }
    table { width: 100%; border-collapse: collapse; font-size: 0.8rem; color: #fff; }
    th, td { border: 1px solid #1e293b; padding: 10px; text-align: left; }
    th { background: #1e293b; color: #38bdf8; }

    footer { position: fixed; bottom: 0; left: 0; width: 100%; background: #0f172a; text-align: center; padding: 15px 0; border-top: 1px solid #1e293b; font-size: 0.8rem; color: #64748b; z-index: 99; }

    #success-screen { display: none; text-align: center; padding: 50px 20px; background: #fff; color: #000; border-radius: 20px; }
    .member-id { font-size: 1.8rem; font-weight: 900; color: #1d4ed8; margin: 20px 0; letter-spacing: 2px; }
  </style>
</head>
<body>

<div class="container">
  <a href="index.html" class="home-btn">üè† Home</a>

  <div class="notice-card">
    <h3>‡∂ö‡∑Ö ‡∂∫‡∑î‡∂≠‡∑î ‡∑É‡∑Ñ ‡∂±‡∑ú‡∂ö‡∑Ö ‡∂∫‡∑î‡∂≠‡∑î ‡∂Ø‡∑ö (Notice)</h3>
    <ul class="notice-list">
      <li>‚úÖ ‡∑É‡∑ê‡∂∏‡∑Ä‡∑í‡∂ß‡∂∏ ‡∂î‡∂∂‡∑ö ‡∑É‡∂≠‡∑ä‚Äç‡∂∫ ‡∂±‡∂∏ ‡∑É‡∑Ñ ‡∂±‡∑í‡∑Ä‡∑ê‡∂ª‡∂Ø‡∑í NIC ‡∂Ö‡∂Ç‡∂ö‡∂∫ ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±.</li>
      <li>‚úÖ ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∂ö‡∑è‡∂ª‡∑ì WhatsApp ‡∂Ö‡∂Ç‡∂ö‡∂∫‡∂ö‡∑ä ‡∂Ω‡∂∂‡∑è‡∂Ø‡∑ì‡∂∏‡∂ß ‡∂ö‡∑è‡∂ª‡∑î‡∂´‡∑í‡∂ö ‡∑Ä‡∂±‡∑ä‡∂±.</li>
      <li>‚ùå ‡∑Ä‡∑ê‡∂ª‡∂Ø‡∑í ‡∂≠‡∑ú‡∂ª‡∂≠‡∑î‡∂ª‡∑î ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∑Ö‡∑Ñ‡∑ú‡∂≠‡∑ä ‡∂Ω‡∑í‡∂∫‡∑è‡∂¥‡∂Ø‡∑í‡∂Ç‡∂†‡∑í‡∂∫ ‡∂Ö‡∑Ä‡∂Ω‡∂Ç‡∂ú‡∑î ‡∑Ä‡∑ö.</li>
      <li>‚ùå ‡∂ë‡∂ö‡∂∏ ‡∂≠‡∑ú‡∂ª‡∂≠‡∑î‡∂ª‡∑î ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∂ª ‡∂ö‡∑í‡∑Ñ‡∑í‡∂¥ ‡∑Ä‡∂≠‡∑è‡∑Ä‡∂ö‡∑ä ‡∂Ω‡∑í‡∂∫‡∑è‡∂¥‡∂Ø‡∑í‡∂Ç‡∂†‡∑í ‡∂±‡∑ú‡∑Ä‡∂±‡∑ä‡∂±.</li>
    </ul>
  </div>

  <div class="form-wrapper" id="main-form">
    <div class="tabs">
        <div class="tab active-tab">Register<br>Form</div>
        <div class="tab" style="background: #1e293b;">Members<br>ID</div>
        <div class="tab" style="background: #1e293b;">Wallet<br>Profile</div>
    </div>

    <h2 style="color: #000;">Register as a Freelancer</h2>
    
    <form id="freelancerForm">
        <label>NIC (‡∑Ñ‡∑ê‡∂≥‡∑î‡∂±‡∑î‡∂∏‡∑ä‡∂¥‡∂≠‡∑ä ‡∂Ö‡∂Ç‡∂ö‡∂∫)</label>
        <input type="text" id="nic" placeholder="‡∂ã‡∂Ø‡∑è: 19XXXXXXXXXX" required>

        <label>Real Name (‡∑É‡∑ê‡∂∂‡∑ë ‡∂±‡∂∏)</label>
        <input type="text" id="fullname" placeholder="‡∂î‡∂∂‡∑ö ‡∑É‡∂∏‡∑ä‡∂¥‡∑ñ‡∂ª‡∑ä‡∂´ ‡∂±‡∂∏" required>

        <label>WhatsApp No</label>
        <input type="tel" id="whatsapp" placeholder="07XXXXXXXX" required>

        <label>District (‡∂Ø‡∑í‡∑É‡∑ä‡∂≠‡∑ä‚Äç‡∂ª‡∑í‡∂ö‡∑ä‡∂ö‡∂∫)</label>
        <select id="district" required>
          <option value="">-- ‡∂≠‡∑ù‡∂ª‡∂±‡∑ä‡∂± --</option>
          <option>Colombo</option><option>Gampaha</option><option>Kalutara</option><option>Kandy</option><option>Matale</option><option>Nuwara Eliya</option><option>Galle</option><option>Matara</option><option>Hambantota</option><option>Jaffna</option><option>Kilinochchi</option><option>Mannar</option><option>Vavuniya</option><option>Mullaitivu</option><option>Batticaloa</option><option>Ampara</option><option>Trincomalee</option><option>Kurunegala</option><option>Puttalam</option><option>Anuradhapura</option><option>Polonnaruwa</option><option>Badulla</option><option>Moneragala</option><option>Ratnapura</option><option>Kegalle</option>
        </select>

        <button type="submit" id="submitBtn" class="btn-register">Register Now</button>
    </form>
  </div>

  <div id="success-screen">
    <div style="font-size: 50px; color: #22c55e;">‚úî</div>
    <h1 style="color: #22c55e;">Success!</h1>
    <p>‡∂Ω‡∑í‡∂∫‡∑è‡∂¥‡∂Ø‡∑í‡∂Ç‡∂†‡∑í‡∂∫ ‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∂∫‡∑í. ‡∂î‡∂∂‡∑ö ID ‡∂ë‡∂ö:</p>
    <div class="member-id" id="m-id"></div>
    <button class="btn-register" onclick="window.location.href='index.html'">Back to Home</button>
  </div>

  <div class="error-section">
    <h4>‡∂Ω‡∑í‡∂∫‡∑è‡∂¥‡∂Ø‡∑í‡∂Ç‡∂†‡∑í ‡∑Ä‡∑ì‡∂∏‡∑ö‡∂Ø‡∑ì ‡∂á‡∂≠‡∑í‡∑Ä‡∂± ‡∂ú‡∑ê‡∂ß‡∑Ö‡∑î (Solutions)</h4>
    <table>
      <tr>
        <th>‡∂ú‡∑ê‡∂ß‡∑Ö‡∑î‡∑Ä (Error)</th>
        <th>‡∂¥‡∑í‡∑Ö‡∑í‡∂∫‡∂∏ (Solution)</th>
      </tr>
      <tr>
        <td>‡∂Ø‡∂≠‡∑ä‡∂≠ ‡∂∫‡∑ê‡∑Ä‡∑ì‡∂∏‡∑ö‡∂Ø‡∑ì ‡∂Ø‡∑ù‡∑Ç‡∂∫‡∂ö‡∑ä ‡∂á‡∂≠‡∑í ‡∑Ä‡∑ì‡∂∏</td>
        <td>‡∂Ö‡∂±‡∑ä‡∂≠‡∂ª‡∑ä‡∂¢‡∑è‡∂Ω ‡∑É‡∂∏‡∑ä‡∂∂‡∂±‡∑ä‡∂∞‡∂≠‡∑è‡∑Ä‡∂∫ ‡∂¥‡∂ª‡∑ì‡∂ö‡∑ä‡∑Ç‡∑è ‡∂ö‡∂ª ‡∂±‡∑ê‡∑Ä‡∂≠ ‡∂ã‡∂≠‡∑ä‡∑É‡∑è‡∑Ñ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±.</td>
      </tr>
      <tr>
        <td>ID ‡∂Ö‡∂Ç‡∂ö‡∂∫ ‡∂Ø‡∑í‡∑É‡∑ä ‡∂±‡∑ú‡∑Ä‡∑ì‡∂∏</td>
        <td>‡∂¥‡∑í‡∂ß‡∑î‡∑Ä Refresh ‡∂ö‡∂ª ‡∂±‡∑ê‡∑Ä‡∂≠ ‡∂≠‡∑ú‡∂ª‡∂≠‡∑î‡∂ª‡∑î ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±.</td>
      </tr>
    </table>
  </div>
</div>

<footer>
  &copy; 2025 Freelance work- All Rights Reserved.
</footer>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  const form = document.getElementById('freelancerForm');
  const submitBtn = document.getElementById('submitBtn');
  
  const SHEETDB_URL = 'https://sheetdb.io/api/v1/75frytfjpik0e';
  const FORMSPREE_URL = 'https://formspree.io/f/meeqqlwl';

  const firebaseConfig = {
    apiKey: "AIzaSyB01A6SNm1wW7YVDzHjNGFSZIZekMQ4Wo0",
    authDomain: "frelance-work.firebaseapp.com",
    databaseURL: "https://frelance-work-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "frelance-work",
    storageBucket: "frelance-work.firebasestorage.app",
    messagingSenderId: "414755878034",
    appId: "1:414755878034:web:a2498b02415ae25e52e24b"
  };

  firebase.initializeApp(firebaseConfig);
  const database = firebase.database();

  form.onsubmit = async (e) => {
    e.preventDefault();
    
    submitBtn.innerText = "Processing...";
    submitBtn.disabled = true;

    const nicInput = document.getElementById('nic').value.trim();
    const nameInput = document.getElementById('fullname').value.trim();
    const whatsappInput = document.getElementById('whatsapp').value.trim();
    const districtInput = document.getElementById('district').value;

    try {
      // 1. Firebase Counter ‡∂ë‡∂ö ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∂ª ‡∂Ö‡∂±‡∑î‡∂¥‡∑í‡∑Ö‡∑í‡∑Ä‡∑ô‡∂Ω‡∂ß ID ‡∂ë‡∂ö‡∂ö‡∑ä ‡∑É‡∑è‡∂Ø‡∑è ‡∂ú‡∑ê‡∂±‡∑ì‡∂∏
      const counterRef = database.ref('memberCounter');
      
      const result = await counterRef.transaction((currentValue) => {
        return (currentValue || 0) + 1;
      });

      const nextNumber = result.snapshot.val();
      const formattedID = "FW" + nextNumber.toString().padStart(4, '0');

      // 2. Firebase ‡∂Ø‡∂≠‡∑ä‡∂≠
      const firebaseData = {
        name: nameInput,
        memberId: formattedID,
        district: districtInput,
        whatsapp: whatsappInput,
        jobsCompleted: 0, 
        balance: "0"
      };

      const sheetData = {
        "NIC_Number": nicInput,
        "Full_Name": nameInput,
        "WhatsApp_No": whatsappInput,
        "District": districtInput,
        "Member_ID": formattedID
      };

      // 3. ‡∑É‡∑í‡∂∫‡∂Ω‡∑î‡∂∏ ‡∂≠‡∑ê‡∂±‡∑ä‡∑Ä‡∂Ω‡∂ß ‡∂Ø‡∂≠‡∑ä‡∂≠ ‡∂∫‡∑ê‡∑Ä‡∑ì‡∂∏
      await database.ref('members/' + nicInput).set(firebaseData);

      await fetch(SHEETDB_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ data: [sheetData] })
      });

      await fetch(FORMSPREE_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
        body: JSON.stringify(sheetData)
      });

      // ‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö ‡∂≠‡∑í‡∂ª‡∂∫ ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∑ì‡∂∏
      document.getElementById('m-id').innerText = formattedID;
      document.getElementById('main-form').style.display = 'none';
      document.getElementById('success-screen').style.display = 'block';
      window.scrollTo(0,0);
      
    } catch (error) {
      console.error(error);
      alert("‡∂Ö‡∂±‡∑ä‡∂≠‡∂ª‡∑ä‡∂¢‡∑è‡∂Ω ‡∑É‡∂∏‡∑ä‡∂∂‡∂±‡∑ä‡∂∞‡∂≠‡∑è‡∑Ä‡∂∫‡∑ö ‡∂ú‡∑ê‡∂ß‡∂Ω‡∑î‡∑Ä‡∂ö‡∑ä ‡∑Ñ‡∑ù ‡∂Ø‡∑ù‡∑Ç‡∂∫‡∂ö‡∑ä ‡∂á‡∂≠‡∑í ‡∑Ä‡∑í‡∂∫! ‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂±‡∑ê‡∑Ä‡∂≠ ‡∂ã‡∂≠‡∑ä‡∑É‡∑è‡∑Ñ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±.");
      submitBtn.innerText = "Register Now";
      submitBtn.disabled = false;
    }
  };
</script>

</body>
</html>
