<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="utf-8">
    <title>Admin Dashboard - Freelance Work</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0">
    <style>
        :root {
            --bg: #0b1220;
            --card: #1e293b;
            --accent: #38bdf8;
            --text: #f8fafc;
            --muted: #94a3b8;
            --green: #22c55e;
        }

        body { 
            background: var(--bg); 
            color: var(--text); 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            padding: 20px; 
        }

        /* Login Overlay */
        #loginOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg); display: flex; justify-content: center; align-items: center;
            z-index: 10000;
        }

        .login-box {
            background: var(--card); padding: 40px; border-radius: 24px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); text-align: center; width: 350px;
        }

        .container { max-width: 900px; margin: 0 auto; display: none; }

        h2 { color: var(--accent); margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }

        /* Card Styles */
        .admin-card { 
            background: var(--card); padding: 25px; border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); margin-bottom: 30px; 
            border: 1px solid rgba(255,255,255,0.05);
        }

        textarea { 
            width: 100%; height: 80px; padding: 15px; border-radius: 12px; 
            border: 1px solid #334155; background: #0b1220; color: white; 
            font-size: 1rem; resize: none; box-sizing: border-box; 
        }

        input[type="text"], input[type="password"] {
            width: 100%; padding: 12px; margin-top: 10px; border-radius: 8px;
            border: 1px solid #334155; background: #0b1220; color: white; box-sizing: border-box;
        }

        button { 
            background: var(--accent); color: #000; border: none; padding: 12px 20px; 
            border-radius: 10px; font-weight: bold; cursor: pointer; width: 100%; 
            transition: 0.3s; margin-top: 15px;
        }

        button:hover { background: #0ea5e9; }

        /* Member List Styles */
        .member-item {
            background: rgba(255,255,255,0.03); padding: 20px; border-radius: 15px;
            margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.05);
            display: flex; flex-wrap: wrap; gap: 20px; align-items: center;
        }

        .member-img {
            width: 80px; height: 80px; border-radius: 50%; object-fit: cover;
            border: 2px solid var(--accent);
        }

        .member-info { flex: 1; min-width: 200px; }
        .member-info div { font-size: 0.9rem; margin-bottom: 5px; }
        .member-info b { color: var(--accent); }

        .edit-controls { display: flex; gap: 10px; flex-direction: column; }
        .btn-sm { padding: 8px 15px; font-size: 0.8rem; width: auto; }
        .btn-save { background: var(--green); color: white; display: none; }

        .status { color: var(--green); font-size: 0.85rem; margin-top: 10px; display: none; }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div class="login-box">
        <span class="material-symbols-outlined" style="font-size: 48px; color: var(--accent);">admin_panel_settings</span>
        <h3 style="margin-top: 10px;">Admin Login</h3>
        <input type="password" id="adminIdInput" placeholder="Enter Admin ID">
        <button onclick="checkLogin()">Login</button>
    </div>
</div>

<div class="container" id="adminContent">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h2><span class="material-symbols-outlined">dashboard</span> Dashboard</h2>
        <button class="btn-sm" style="background: #ef4444; color: white;" onclick="location.reload()">Logout</button>
    </div>

    <div class="admin-card">
        <h3>üì¢ Live Notice Control</h3>
        <textarea id="noticeInput" placeholder="‡∑É‡∑è‡∂∏‡∑è‡∂¢‡∑í‡∂ö‡∂∫‡∑í‡∂±‡∑ä‡∂ß ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î ‡∂¥‡∂´‡∑í‡∑Ä‡∑í‡∂©‡∂∫..."></textarea>
        <button onclick="updateNotice()">Update Home Notice</button>
        <div id="statusMsg" class="status">‚úÖ ‡∂±‡∑í‡∑Ä‡∑ö‡∂Ø‡∂±‡∂∫ ‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∑Ä ‡∂∫‡∑è‡∑Ä‡∂≠‡∑ä‡∂ö‡∑è‡∂Ω‡∑ì‡∂± ‡∑Ä‡∑í‡∂∫!</div>
    </div>

    <h2><span class="material-symbols-outlined">groups</span> Member Profiles</h2>
    <div id="memberList">
        <p style="color: var(--muted);">Loading members...</p>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyB01A6SNm1wW7YVDzHjNGFSZIZekMQ4Wo0",
        databaseURL: "https://frelance-work-default-rtdb.asia-southeast1.firebasedatabase.app"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // 1. Login Logic
    function checkLogin() {
        const id = document.getElementById('adminIdInput').value;
        if (id === "FW0001") {
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('adminContent').style.display = 'block';
            loadData();
        } else {
            alert("‡∑Ä‡∑ê‡∂ª‡∂Ø‡∑í Member ID ‡∂ë‡∂ö‡∂ö‡∑í. ‡∂á‡∂≠‡∑î‡∑Ö‡∑î ‡∑Ä‡∑ì‡∂∏‡∂ß ‡∂Ö‡∑Ä‡∑É‡∂ª ‡∂±‡∑ê‡∂≠.");
        }
    }

    function loadData() {
        loadNotice();
        loadMembers();
    }

    // 2. Notice Functions
    function loadNotice() {
        database.ref('admin_notice').on('value', (snapshot) => {
            if (snapshot.exists()) {
                document.getElementById('noticeInput').value = snapshot.val();
            }
        });
    }

    function updateNotice() {
        const newNotice = document.getElementById('noticeInput').value;
        database.ref('/').update({ admin_notice: newNotice }).then(() => {
            document.getElementById('statusMsg').style.display = 'block';
            setTimeout(() => { document.getElementById('statusMsg').style.display = 'none'; }, 3000);
        });
    }

    // 3. Member Management Functions
    async function loadMembers() {
        const listDiv = document.getElementById('memberList');
        database.ref('members').on('value', (snapshot) => {
            listDiv.innerHTML = "";
            const data = snapshot.val();
            if (!data) {
                listDiv.innerHTML = "<p>‡∑É‡∑è‡∂∏‡∑è‡∂¢‡∑í‡∂ö‡∂∫‡∑í‡∂±‡∑ä ‡∂¥‡∂Ø‡∑ä‡∂∞‡∂≠‡∑í‡∂∫‡∑ö ‡∂±‡∑ê‡∂≠.</p>";
                return;
            }

            for (let nic in data) {
                const m = data[nic];
                listDiv.innerHTML += `
                    <div class="member-item" id="card-${nic}">
                        <img src="${m.photo || 'https://via.placeholder.com/80'}" class="member-img">
                        <div class="member-info" id="info-${nic}">
                            <div><b>Name:</b> <span class="v-name">${m.name || 'N/A'}</span></div>
                            <div><b>NIC:</b> <span>${nic}</span></div>
                            <div><b>Member ID:</b> <span class="v-mid">${m.memberId || 'N/A'}</span></div>
                            <div><b>WhatsApp:</b> <span class="v-wa">${m.whatsapp || 'N/A'}</span></div>
                            <div><b>Balance:</b> Rs. <span class="v-bal">${m.balance || '0'}</span></div>
                        </div>
                        <div class="edit-controls">
                            <button class="btn-sm" onclick="enableEdit('${nic}')">Edit Details</button>
                            <button class="btn-sm btn-save" id="save-${nic}" onclick="saveEdit('${nic}')">Save Changes</button>
                        </div>
                    </div>
                `;
            }
        });
    }

    function enableEdit(nic) {
        const infoDiv = document.getElementById(`info-${nic}`);
        const name = infoDiv.querySelector('.v-name').innerText;
        const mid = infoDiv.querySelector('.v-mid').innerText;
        const wa = infoDiv.querySelector('.v-wa').innerText;
        const bal = infoDiv.querySelector('.v-bal').innerText;

        infoDiv.innerHTML = `
            <div><b>Name:</b> <input type="text" id="edit-name-${nic}" value="${name}"></div>
            <div><b>NIC:</b> <span>${nic}</span></div>
            <div><b>Member ID:</b> <input type="text" id="edit-mid-${nic}" value="${mid}"></div>
            <div><b>WhatsApp:</b> <input type="text" id="edit-wa-${nic}" value="${wa}"></div>
            <div><b>Balance:</b> <input type="text" id="edit-bal-${nic}" value="${bal}"></div>
        `;
        document.getElementById(`save-${nic}`).style.display = 'block';
    }

    async function saveEdit(nic) {
        const newName = document.getElementById(`edit-name-${nic}`).value;
        const newMid = document.getElementById(`edit-mid-${nic}`).value;
        const newWa = document.getElementById(`edit-wa-${nic}`).value;
        const newBal = document.getElementById(`edit-bal-${nic}`).value;

        await database.ref('members/' + nic).update({
            name: newName,
            memberId: newMid,
            whatsapp: newWa,
            balance: newBal
        });

        alert("‡∑É‡∑è‡∂∏‡∑è‡∂¢‡∑í‡∂ö‡∂∫‡∑è‡∂ú‡∑ö ‡∑Ä‡∑í‡∑É‡∑ä‡∂≠‡∂ª ‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∑Ä ‡∂∫‡∑è‡∑Ä‡∂≠‡∑ä‡∂ö‡∑è‡∂Ω‡∑ì‡∂± ‡∂ö‡∂ª‡∂± ‡∂Ω‡∂Ø‡∑ì!");
    }
</script>

</body>
</html>
