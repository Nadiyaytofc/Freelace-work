<!DOCTYPE html>
<html lang="si">
<head>
  <meta charset="utf-8">
  <title>eWallet / Profile - Freelance work</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0">
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    body { background-color: #0b1220; color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; }
    .container { max-width: 600px; margin: 0 auto; padding: 20px; padding-bottom: 80px; }
    
    header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 20px; border-bottom: 1px solid #1e293b; }
    .logo-box { display: flex; align-items: center; gap: 10px; }
    .logo-icon { background: #38bdf8; color: #000; font-weight: 900; padding: 8px 12px; border-radius: 8px; font-size: 1.2rem; }
    .logo-text { line-height: 1.2; }
    .logo-title { font-weight: bold; font-size: 1rem; display: block; }
    .logo-subtitle { font-size: 0.65rem; color: #94a3b8; }
    .home-btn { background: #1e293b; color: #fff; padding: 8px 15px; border-radius: 8px; text-decoration: none; border: 1px solid #334155; font-size: 0.85rem; display: flex; align-items: center; gap: 5px; }

    .main-title { margin-top: 30px; font-size: 1.5rem; font-weight: bold; }
    .main-title span { color: #38bdf8; }
    
    .profile-card { background: #fff; color: #334155; padding: 25px; border-radius: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    .tabs { display: flex; background: #000; padding: 5px; border-radius: 50px; margin-bottom: 25px; gap: 5px; }
    .tab { flex: 1; text-align: center; color: white; padding: 10px 5px; font-size: 0.65rem; border-radius: 50px; text-decoration: none; display: flex; flex-direction: column; justify-content: center; line-height: 1.2; }
    .active-tab { background: #38bdf8; color: black; font-weight: bold; }
    
    .input-group { margin-bottom: 20px; }
    .input-group label { display: block; font-weight: bold; font-size: 0.85rem; margin-bottom: 8px; color: #1e293b; }
    .input-group input { width: 100%; padding: 15px; border: 1px solid #cbd5e1; border-radius: 12px; box-sizing: border-box; font-size: 0.9rem; background: #f8fafc; color: #000; }
    .btn-show { background: #000; color: #fff; width: 100%; padding: 16px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 0.9rem; display: flex; justify-content: center; align-items: center; gap: 10px; }

    #profile-result { display: none; margin-top: 25px; background: #fff; border-radius: 20px; padding: 15px; border: 1px solid #e2e8f0; }
    
    /* Photo & Badge Styles */
    .profile-photo-wrapper { text-align: center; margin-bottom: 15px; position: relative; }
    .user-profile-img { width: 110px; height: 110px; border-radius: 50%; border: 4px solid #38bdf8; object-fit: cover; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
    .badge-container { display: flex; justify-content: center; gap: 10px; margin-top: 10px; }
    .badge-item { padding: 4px 12px; border-radius: 20px; font-size: 0.7rem; font-weight: bold; display: flex; align-items: center; gap: 5px; }
    .badge-bronze { background: #cd7f32; color: #fff; }
    .badge-silver { background: #c0c0c0; color: #333; }
    .badge-gold { background: #ffd700; color: #333; }
    .badge-diamond { background: #b9f2ff; color: #000; border: 1px solid #38bdf8; }

    /* Progress Bar */
    .progress-section { margin-top: 15px; padding: 12px; border-radius: 15px; background: #f1f5f9; border: 1px solid #e2e8f0; }
    .progress-labels { display: flex; justify-content: space-between; font-size: 0.75rem; font-weight: bold; color: #64748b; margin-bottom: 5px; }
    .progress-bar-bg { width: 100%; height: 10px; background: #cbd5e1; border-radius: 10px; overflow: hidden; }
    .progress-bar-fill { height: 100%; background: linear-gradient(90deg, #38bdf8, #0ea5e9); width: 0%; transition: width 1s ease-in-out; }

    /* ID Card Design */
    #id-card-wrapper { display: none; margin-top: 30px; text-align: center; background: #f8fafc; padding: 20px; border-radius: 20px; border: 1px dashed #cbd5e1; }
    .id-card { width: 280px; height: 420px; background: linear-gradient(135deg, #0b1220 0%, #1e293b 100%); border-radius: 15px; margin: 0 auto; color: white; padding: 20px; border: 2px solid #38bdf8; position: relative; box-shadow: 0 10px 25px rgba(0,0,0,0.4); }
    .id-header { font-weight: bold; font-size: 0.85rem; color: #38bdf8; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; }
    .id-sub { font-size: 0.55rem; color: #94a3b8; margin-bottom: 15px; }
    .id-photo { width: 90px; height: 90px; border-radius: 10px; border: 2px solid #38bdf8; object-fit: cover; margin-bottom: 12px; }
    .id-name { font-size: 0.95rem; font-weight: bold; margin-bottom: 5px; color: #fff; }
    .id-info { font-size: 0.7rem; color: #cbd5e1; margin-bottom: 3px; }
    .id-footer { margin-top: 25px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 12px; font-size: 0.5rem; color: #64748b; line-height: 1.4; }
    .btn-download { background: #000; color: #fff; padding: 12px 20px; border-radius: 50px; font-size: 0.8rem; border: none; cursor: pointer; margin-top: 15px; display: inline-flex; align-items: center; gap: 8px; font-weight: bold; }

    /* Rest of UI */
    .profile-header-nic { color: #38bdf8; font-weight: 800; font-size: 1.1rem; margin: 15px 0; text-align: center; }
    .info-table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
    .info-table td { padding: 10px; border-bottom: 1px solid #f1f5f9; font-size: 0.85rem; color: #1e293b; font-weight: 600; }
    .info-table tr td:first-child { color: #64748b; font-weight: normal; width: 40%; }
    .status-box { background: #000; color: #fff; padding: 15px; border-radius: 15px; margin-bottom: 15px; }
    .status-msg { font-weight: bold; font-size: 0.8rem; color: #fbbf24; }
    .balance-box { background: #000; color: #fff; padding: 20px; border-radius: 15px; }
    .bal-value { font-size: 1.2rem; font-weight: 900; color: #38bdf8; }
    footer { text-align: center; margin-top: 40px; font-size: 0.7rem; color: #475569; padding: 20px; border-top: 1px solid #1e293b; }
    .loader { border: 3px solid #f3f3f3; border-top: 3px solid #38bdf8; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: none; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body>

<div class="container">
  <header>
    <div class="logo-box">
      <div class="logo-icon">FW</div>
      <div class="logo-text">
        <span class="logo-title">FREELANCE WORK</span>
        <span class="logo-subtitle">Business HUB Sri Lanka</span>
      </div>
    </div>
    <a href="index.html" class="home-btn"> Home</a>
  </header>

  <h2 class="main-title">eWallet <span>Profile</span></h2>

  <div class="profile-card">
    <div class="tabs">
      <a href="register.html" class="tab">Register<span>Freelancer</span></a>
      <a href="leaderboard.html" class="tab" style="background: #1e293b;">Members<span>Leaderboard</span></a>
      <a href="wallet.html" class="tab active-tab">Wallet<span>Profile</span></a>
    </div>

    <div id="search-section">
      <div class="input-group">
        <label>NIC ‡∂Ö‡∂Ç‡∂ö‡∂∫ ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</label>
        <input type="text" id="searchNic" placeholder="Eg: 1999xxxxxxx">
      </div>
      <button class="btn-show" id="searchBtn" onclick="searchProfile()">
        <span id="btnLabel">Profile ‡∂ë‡∂ö ‡∂∂‡∂Ω‡∂±‡∑ä‡∂±</span>
        <div class="loader" id="searchLoader"></div>
      </button>
    </div>

    <div id="profile-result">
      <div class="profile-photo-wrapper">
         <img id="res-photo" src="https://via.placeholder.com/110" class="user-profile-img">
         <div class="badge-container" id="res-badge"></div>
      </div>

      <div class="progress-section">
        <div class="progress-labels">
          <span>Job Target (500)</span>
          <span id="progress-percent">0%</span>
        </div>
        <div class="progress-bar-bg">
          <div id="progress-bar-fill" class="progress-bar-fill"></div>
        </div>
      </div>

      <div class="profile-header-nic">NIC: <span id="res-nic-display"></span></div>
      
      <table class="info-table">
        <tbody>
          <tr><td>Member ID</td><td id="res-id"></td></tr>
          <tr><td>Name</td><td id="res-name"></td></tr>
          <tr><td>District</td><td id="res-district"></td></tr>
          <tr><td>Jobs Completed</td><td id="res-jobs">0</td></tr>
        </tbody>
      </table>

      <div class="status-box">
        <div class="status-msg" id="res-status">‡∂¥‡∂ª‡∑ì‡∂ö‡∑ä‡∑Ç‡∑è ‡∂ö‡∂ª‡∂∏‡∑í‡∂±‡∑ä...</div>
      </div>

      <div class="balance-box">
        <div style="font-size:0.8rem; margin-bottom:5px;">Wallet Balance</div>
        <div class="bal-value" id="res-balance">Rs.0.00</div>
      </div>

      <div id="id-card-wrapper">
        <div class="id-card" id="my-id-card">
          <div class="id-header">FREELANCE WORK</div>
          <div class="id-sub">BUSINESS HUB SRI LANKA</div>
          <img id="id-res-photo" src="" class="id-photo">
          <div class="id-name" id="id-res-name">NAME</div>
          <div class="id-info">ID: <span id="id-res-mid">FW000</span></div>
          <div class="id-info">NIC: <span id="id-res-nic"></span></div>
          <div class="id-info">DISTRICT: <span id="id-res-dist"></span></div>
          <div style="margin-top: 10px;">
            <span id="id-res-badge-ui" style="background: #38bdf8; color: #000; padding: 2px 8px; border-radius: 5px; font-size: 0.6rem; font-weight: 900;">MEMBER</span>
          </div>
          <div class="id-footer">
            NH TECH ACADEMY (PVT) LTD<br>Official Freelancer Identity Card
          </div>
        </div>
        <button class="btn-download" onclick="downloadID()">
          <span class="material-symbols-outlined">download</span> Download ID Card (PNG)
        </button>
      </div>
    </div>
  </div>

  <footer>
     NH TECH ACCDAMY (Pvt) Ltd (Business HUB Sri Lanka)
  </footer>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyB01A6SNm1wW7YVDzHjNGFSZIZekMQ4Wo0",
    databaseURL: "https://frelance-work-default-rtdb.asia-southeast1.firebasedatabase.app"
  };
  firebase.initializeApp(firebaseConfig);
  const database = firebase.database();

  function searchProfile() {
    const nicInput = document.getElementById('searchNic').value.trim();
    const resultDiv = document.getElementById('profile-result');
    const loader = document.getElementById('searchLoader');
    const btnLabel = document.getElementById('btnLabel');

    if (!nicInput) { alert("‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª NIC ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±."); return; }

    loader.style.display = 'block';
    btnLabel.style.display = 'none';

    database.ref('members/' + nicInput).once('value').then((snapshot) => {
      if (snapshot.exists()) {
        const user = snapshot.val();
        const jobsDone = parseInt(user.jobsCompleted || 0);
        
        // Fill Profile Data
        document.getElementById('res-nic-display').innerText = nicInput;
        document.getElementById('res-name').innerText = user.name;
        document.getElementById('res-id').innerText = user.memberId || "Pending";
        document.getElementById('res-district').innerText = user.district;
        document.getElementById('res-jobs').innerText = jobsDone;
        document.getElementById('res-balance').innerText = "Rs." + (user.balance || "0");
        document.getElementById('res-photo').src = user.photo || "https://via.placeholder.com/110";

        // Progress Bar Logic
        const percentage = Math.min((jobsDone / 500) * 100, 100);
        document.getElementById('progress-bar-fill').style.width = percentage + "%";
        document.getElementById('progress-percent').innerText = Math.round(percentage) + "%";

        // Badge & ID Card Data
        const badgeContainer = document.getElementById('res-badge');
        let badgeTxt = "MEMBER";
        badgeContainer.innerHTML = "";
        
        if (jobsDone >= 500) { badgeContainer.innerHTML = '<div class="badge-item badge-diamond">üíé Diamond</div>'; badgeTxt = "üíé DIAMOND"; }
        else if (jobsDone >= 100) { badgeContainer.innerHTML = '<div class="badge-item badge-gold">ü•á Gold</div>'; badgeTxt = "ü•á GOLD"; }
        else if (jobsDone >= 50) { badgeContainer.innerHTML = '<div class="badge-item badge-silver">ü•à Silver</div>'; badgeTxt = "ü•à SILVER"; }
        else if (jobsDone >= 10) { badgeContainer.innerHTML = '<div class="badge-item badge-bronze">ü•â Bronze</div>'; badgeTxt = "ü•â BRONZE"; }

        // ID Card Update
        document.getElementById('id-card-wrapper').style.display = 'block';
        document.getElementById('id-res-name').innerText = user.name;
        document.getElementById('id-res-mid').innerText = user.memberId || "Pending";
        document.getElementById('id-res-nic').innerText = nicInput;
        document.getElementById('id-res-dist').innerText = user.district;
        document.getElementById('id-res-photo').src = user.photo || "https://via.placeholder.com/100";
        document.getElementById('id-res-badge-ui').innerText = badgeTxt;

        // Status Msg
        document.getElementById('res-status').innerText = jobsDone >= 10 ? "Verified Account" : "Not Verified (Complete 10 Jobs)";
        document.getElementById('res-status').style.color = jobsDone >= 10 ? "#22c55e" : "#fbbf24";

        resultDiv.style.display = 'block';
      } else {
        alert("‡∑É‡∑ú‡∂∫‡∑è‡∂ú‡∂≠ ‡∂±‡∑ú‡∑Ñ‡∑ê‡∂ö.");
      }
    }).finally(() => {
      loader.style.display = 'none';
      btnLabel.style.display = 'block';
    });
  }

  function downloadID() {
    const card = document.getElementById('my-id-card');
    html2canvas(card, { useCORS: true, scale: 3 }).then(canvas => {
      const link = document.createElement('a');
      link.download = 'FW-ID-Card.png';
      link.href = canvas.toDataURL("image/png");
      link.click();
    });
  }
</script>
</body>
  </html>
